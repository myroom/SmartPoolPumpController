# Pool Pump Scheduler Blueprint

Автоматическое управление насосом бассейна на основе объема, производительности и учета ручной работы за день.

## Описание

Этот blueprint автоматически:

-   Рассчитывает необходимое время работы насоса для полной циркуляции воды в бассейне
-   Учитывает ручное включение насоса в течение дня
-   Корректирует автоматическое расписание, чтобы не превышать максимальное время работы
-   Предоставляет три режима работы: Auto, On, Off

## Необходимые сенсоры и entities

Добавьте следующие entities в ваш `configuration.yaml`:

### 1. Input Select для режима работы насоса

```yaml
input_select:
    pool_pump_mode:
        name: Pool Pump Mode
        options:
            - 'Auto'
            - 'On'
            - 'Off'
        initial: 'Auto'
        icon: mdi:water-pump
```

**Режимы:**

-   `Auto` - Автоматическое управление по расписанию
-   `On` - Принудительно включен (всегда работает)
-   `Off` - Принудительно выключен (не работает)

### 2. Sensor для подсчета времени работы насоса за день

```yaml
sensor:
    - platform: history_stats
      name: Daily Pump Runtime Sensor
      entity_id: switch.pool_pump # замените на вашу сущность насоса
      state: 'on'
      type: time
      start: '{{ now().replace(hour=0, minute=0, second=0) }}'
      end: '{{ now() }}'
```

## Настройка Blueprint

1. Импортируйте blueprint в Home Assistant
2. Создайте автоматизацию на основе blueprint
3. Настройте параметры:
    - **Pump**: Выберите сущность вашего насоса (switch)
    - **Pool Volume**: Объем бассейна в литрах
    - **Pump Flow Rate**: Производительность насоса в л/ч
    - **Maximum Daily Run Time**: Максимальное время работы в день (часы)
    - **Pump Interval**: Интервал между включениями насоса (часы, по умолчанию 1)
    - **Pool Pump Mode**: input_select.pool_pump_mode
    - **Daily Pump Runtime Sensor**: sensor.pool_pump_daily_runtime

## Принцип работы

1. **Простая логика интервалов**: Blueprint использует заданный интервал между включениями насоса (по умолчанию 1 час)

2. **Учет ручной работы**: Отслеживает общее время работы насоса за день через history_stats сенсор

3. **Автоматическое включение**: В режиме "Auto" насос включается автоматически, когда:

    - Насос выключен
    - Прошло заданное время с последнего изменения состояния (pump_interval)
    - Не превышен дневной лимит времени работы (maximum_run_time)

4. **Ручные режимы**:
    - "On" - насос всегда включен
    - "Off" - насос всегда выключен

## Примечания

-   Все единицы измерения (объем и производительность) должны быть в одной системе (литры/час, м³/час и т.д.)
-   Автоматизация проверяет состояние каждую минуту
-   При ручном включении насоса время учитывается автоматически
-   Рекомендуется настроить уведомления при превышении дневного лимита времени работы
